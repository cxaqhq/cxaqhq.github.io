<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <title>windows后门持久化 | cx网络安全小站</title>
  <meta name="keywords" content=" 后门 ">
  <meta name="description" content="windows后门持久化 | cx网络安全小站">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="在添加chaosvpn 源后更新系统会报错。没有公钥，这个时候我们直接添加就行。   命令如下    sudo apt-key adv –keyserver keyserver.ubuntu.com –recv-keys 157614093BD8041F 后面那一串字符改成自己的！ 考试已经考完了，后天准备回家！">
<meta property="og:type" content="article">
<meta property="og:title" content="安装chaosvpn">
<meta property="og:url" content="http://yoursite.com/2020/01/09/安装chaosvpn/index.html">
<meta property="og:site_name" content="cx网络安全小站">
<meta property="og:description" content="在添加chaosvpn 源后更新系统会报错。没有公钥，这个时候我们直接添加就行。   命令如下    sudo apt-key adv –keyserver keyserver.ubuntu.com –recv-keys 157614093BD8041F 后面那一串字符改成自己的！ 考试已经考完了，后天准备回家！">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2020-01-09T12:10:23.217Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="安装chaosvpn">
<meta name="twitter:description" content="在添加chaosvpn 源后更新系统会报错。没有公钥，这个时候我们直接添加就行。   命令如下    sudo apt-key adv –keyserver keyserver.ubuntu.com –recv-keys 157614093BD8041F 后面那一串字符改成自己的！ 考试已经考完了，后天准备回家！">


<link rel="icon" href="/img/cx.jpg">

<link href="/css/style.css?v=1.0.1" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.0.1" rel="stylesheet">

<link href="//cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="/js/jquery.autocomplete.min.js?v=1.0.1"></script>

<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>



<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

<script src="/js/iconfont.js?v=1.0.1"></script>

</head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="true">
  <input class="theme_blog_path" value>
</div>

<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/cx.jpg" />
</a>
<div class="author">
    <span>cx</span>
</div>

<div class="icon">
    
        
    
        
        <a title="github" href="https://github.com/cxaqhq" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-github"></use>
                </svg>
            
        </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
        <a title="zhihu" href="https://www.zhihu.com/people/xiao-yao-you-41-22" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-zhihu"></use>
                </svg>
            
        </a>
        
    
        
    
        
    
        
    
        
        <a title="email" href="mailto:cxaqhq@qq.com" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-email"></use>
                </svg>
            
        </a>
        
    
        
        <a title="qq" href="http://wpa.qq.com/msgrd?v=3&uin=3149820232&site=qq&menu=yes" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-qq"></use>
                </svg>
            
        </a>
        
    
        
    
        
    
</div>




<ul>
    <li><div class="all active">全部文章<small>(56)</small></div></li>
    
        
            
            <li><div data-rel="msf">msf<small>(3)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="web">web<small>(4)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="内网">内网<small>(2)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="windows">windows<small>(6)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="linux">linux<small>(5)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="web实战">web实战<small>(8)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="日志分析">日志分析<small>(5)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="应急响应">应急响应<small>(2)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="法律">法律<small>(1)</small></div>
                
            </li>
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    </div>
    <div></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="56">
<input type="hidden" id="yelog_site_word_count" value="57.8k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="back-title-list"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://yelog.org/">叶落阁</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <form onkeydown="if(event.keyCode==13){return false;}">
        <input class="search" type="text" placeholder="以 in: 开头进行全文搜索" autocomplete="off"id="local-search-input" >
        <i class="cross"></i>
        <span>
            <label for="tagswitch">Tags:</label>
            <input id="tagswitch" type="checkbox" style="display: none" />
            <i id="tagsWitchIcon"></i>
        </span>
    </form>
    <div class="tags-list">
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">msf</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">web</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">phpmyadmin</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">sqlmap</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">密码抓取</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">第四章</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">第三章</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">第五章</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">第二章</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">第一章</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">后门</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">法律</a>
    </li>
    
    <div class="clearfix"></div>
</div>

    
    <div id="local-search-result">

    </div>
    
    <nav id="title-list-nav">
        
        <a id="top" class=""
           href="/2019/10/06/第一篇/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="第一篇">第一篇</span>
            <span class="post-date" title="2019-10-06 10:26:26">2019/10/06</span>
        </a>
        
        <a id="top" class="法律 "
           href="/2019/10/06/网络安全法/"
           data-tag="法律"
           data-author="" >
            <span class="post-title" title="网络安全法">网络安全法</span>
            <span class="post-date" title="2019-10-06 12:26:31">2019/10/06</span>
        </a>
        
        <a  class=""
           href="/2020/01/09/安装chaosvpn/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="安装chaosvpn">安装chaosvpn</span>
            <span class="post-date" title="2020-01-09 20:08:11">2020/01/09</span>
        </a>
        
        <a  class=""
           href="/2019/12/08/不开心/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="不开心">不开心</span>
            <span class="post-date" title="2019-12-08 20:34:07">2019/12/08</span>
        </a>
        
        <a  class=""
           href="/2019/11/29/暗网/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="如何搭建自己的暗网站点">如何搭建自己的暗网站点</span>
            <span class="post-date" title="2019-11-29 14:28:06">2019/11/29</span>
        </a>
        
        <a  class=""
           href="/2019/11/25/茶马古道/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="茶马古道">茶马古道</span>
            <span class="post-date" title="2019-11-25 00:24:48">2019/11/25</span>
        </a>
        
        <a  class=""
           href="/2019/11/08/sqlmap-脚本详解/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="sqlmap 脚本详解">sqlmap 脚本详解</span>
            <span class="post-date" title="2019-11-08 19:09:43">2019/11/08</span>
        </a>
        
        <a  class=""
           href="/2019/10/29/1/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="数据泄漏，暗网，社工库！">数据泄漏，暗网，社工库！</span>
            <span class="post-date" title="2019-10-29 13:03:15">2019/10/29</span>
        </a>
        
        <a  class=""
           href="/2019/10/28/hexo-坑/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="hexo 坑">hexo 坑</span>
            <span class="post-date" title="2019-10-28 09:02:52">2019/10/28</span>
        </a>
        
        <a  class=""
           href="/2019/10/28/树莓派安装MySQL-搭建数据库/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="树莓派安装MySQL 搭建数据库">树莓派安装MySQL 搭建数据库</span>
            <span class="post-date" title="2019-10-28 08:42:07">2019/10/28</span>
        </a>
        
        <a  class=""
           href="/2019/10/28/树莓派安装teamviewer/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="树莓派安装teamviewer">树莓派安装teamviewer</span>
            <span class="post-date" title="2019-10-28 08:38:57">2019/10/28</span>
        </a>
        
        <a  class=""
           href="/2019/10/27/树莓派-4b折腾/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="树莓派 4b折腾">树莓派 4b折腾</span>
            <span class="post-date" title="2019-10-27 23:27:49">2019/10/27</span>
        </a>
        
        <a  class=""
           href="/2019/10/24/攻防世界-web-wp/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="攻防世界-web-wp(新手)">攻防世界-web-wp(新手)</span>
            <span class="post-date" title="2019-10-24 10:24:25">2019/10/24</span>
        </a>
        
        <a  class=""
           href="/2019/10/20/内存取证-密码提取以及Volatility的使用/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="内存取证 Volatility">内存取证 Volatility</span>
            <span class="post-date" title="2019-10-20 17:33:58">2019/10/20</span>
        </a>
        
        <a  class=""
           href="/2019/10/19/360ctf-理论题（2019）/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="360ctf 理论题（2019）">360ctf 理论题（2019）</span>
            <span class="post-date" title="2019-10-19 17:45:49">2019/10/19</span>
        </a>
        
        <a  class=""
           href="/2019/10/18/sql/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="sql 速查表">sql 速查表</span>
            <span class="post-date" title="2019-10-18 14:11:12">2019/10/18</span>
        </a>
        
        <a  class=""
           href="/2019/10/18/自动补全的mysql客户端/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="自动补全的mysql客户端">自动补全的mysql客户端</span>
            <span class="post-date" title="2019-10-18 13:01:46">2019/10/18</span>
        </a>
        
        <a  class=""
           href="/2019/10/17/python操作mysql/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="python操作mysql">python操作mysql</span>
            <span class="post-date" title="2019-10-17 13:05:13">2019/10/17</span>
        </a>
        
        <a  class="web实战 "
           href="/2019/10/16/第1篇：网站被植入Webshell/"
           data-tag="第五章"
           data-author="" >
            <span class="post-title" title="第5章第1篇：网站被植入Webshell">第5章第1篇：网站被植入Webshell</span>
            <span class="post-date" title="2019-10-16 19:30:00">2019/10/16</span>
        </a>
        
        <a  class="web实战 "
           href="/2019/10/16/第2篇：门罗币恶意挖矿/"
           data-tag="第五章"
           data-author="" >
            <span class="post-title" title="第5章第2篇：门罗币恶意挖矿">第5章第2篇：门罗币恶意挖矿</span>
            <span class="post-date" title="2019-10-16 19:30:00">2019/10/16</span>
        </a>
        
        <a  class="web实战 "
           href="/2019/10/16/第5篇：移动端劫持/"
           data-tag="第五章"
           data-author="" >
            <span class="post-title" title="第5章第5篇：移动端劫持">第5章第5篇：移动端劫持</span>
            <span class="post-date" title="2019-10-16 19:29:00">2019/10/16</span>
        </a>
        
        <a  class="web实战 "
           href="/2019/10/16/第3篇：批量挂黑页/"
           data-tag="第五章"
           data-author="" >
            <span class="post-title" title="第5章第3篇：批量挂黑页">第5章第3篇：批量挂黑页</span>
            <span class="post-date" title="2019-10-16 19:29:00">2019/10/16</span>
        </a>
        
        <a  class="web实战 "
           href="/2019/10/16/第6篇：搜索引擎劫持/"
           data-tag="第五章"
           data-author="" >
            <span class="post-title" title="第5章第6篇：搜索引擎劫持">第5章第6篇：搜索引擎劫持</span>
            <span class="post-date" title="2019-10-16 19:29:00">2019/10/16</span>
        </a>
        
        <a  class="web实战 "
           href="/2019/10/16/第4篇：新闻源网站劫持/"
           data-tag="第五章"
           data-author="" >
            <span class="post-title" title="第5章第4篇：新闻源网站劫持">第5章第4篇：新闻源网站劫持</span>
            <span class="post-date" title="2019-10-16 19:29:00">2019/10/16</span>
        </a>
        
        <a  class="web实战 "
           href="/2019/10/16/第7篇：网站首页被篡改/"
           data-tag="第五章"
           data-author="" >
            <span class="post-title" title="第5章第7篇：网站首页被篡改">第5章第7篇：网站首页被篡改</span>
            <span class="post-date" title="2019-10-16 19:28:00">2019/10/16</span>
        </a>
        
        <a  class="应急响应 "
           href="/2019/10/16/第2篇：Linux入侵排查/"
           data-tag="第一章"
           data-author="" >
            <span class="post-title" title="第1章第2篇：Linux入侵排查">第1章第2篇：Linux入侵排查</span>
            <span class="post-date" title="2019-10-16 13:42:00">2019/10/16</span>
        </a>
        
        <a  class="日志分析 "
           href="/2019/10/16/第1篇：Window日志分析/"
           data-tag="第二章"
           data-author="" >
            <span class="post-title" title="第2章第1篇:Window日志分析">第2章第1篇:Window日志分析</span>
            <span class="post-date" title="2019-10-16 13:42:00">2019/10/16</span>
        </a>
        
        <a  class="日志分析 "
           href="/2019/10/16/第3篇：Web日志分析/"
           data-tag="第二章"
           data-author="" >
            <span class="post-title" title="第2章第3篇:Web日志分析">第2章第3篇:Web日志分析</span>
            <span class="post-date" title="2019-10-16 13:42:00">2019/10/16</span>
        </a>
        
        <a  class="日志分析 "
           href="/2019/10/16/第2篇：Linux日志分析/"
           data-tag="第二章"
           data-author="" >
            <span class="post-title" title="第2章第2篇:Linux日志分析">第2章第2篇:Linux日志分析</span>
            <span class="post-date" title="2019-10-16 13:42:00">2019/10/16</span>
        </a>
        
        <a  class="日志分析 "
           href="/2019/10/16/第4篇：MSSQL日志分析/"
           data-tag="第二章"
           data-author="" >
            <span class="post-title" title="第2章第4篇:MSSQL日志分析">第2章第4篇:MSSQL日志分析</span>
            <span class="post-date" title="2019-10-16 13:41:00">2019/10/16</span>
        </a>
        
        <a  class="linux "
           href="/2019/10/16/第1篇：SSH暴力破解/"
           data-tag="第三章"
           data-author="" >
            <span class="post-title" title="第3章第1篇：SSH暴力破解">第3章第1篇：SSH暴力破解</span>
            <span class="post-date" title="2019-10-16 13:41:00">2019/10/16</span>
        </a>
        
        <a  class="日志分析 "
           href="/2019/10/16/第5篇：MySQL日志分析/"
           data-tag="第二章"
           data-author="" >
            <span class="post-title" title="第2章第5篇:MySQL日志分析">第2章第5篇:MySQL日志分析</span>
            <span class="post-date" title="2019-10-16 13:41:00">2019/10/16</span>
        </a>
        
        <a  class="linux "
           href="/2019/10/16/第4篇：盖茨木马/"
           data-tag="第三章"
           data-author="" >
            <span class="post-title" title="第3章第4篇：盖茨木马">第3章第4篇：盖茨木马</span>
            <span class="post-date" title="2019-10-16 13:40:00">2019/10/16</span>
        </a>
        
        <a  class="linux "
           href="/2019/10/16/第2篇：捕捉短连接/"
           data-tag="第三章"
           data-author="" >
            <span class="post-title" title="第3章第2篇：捕捉短连接">第3章第2篇：捕捉短连接</span>
            <span class="post-date" title="2019-10-16 13:40:00">2019/10/16</span>
        </a>
        
        <a  class="linux "
           href="/2019/10/16/第3篇：挖矿病毒/"
           data-tag="第三章"
           data-author="" >
            <span class="post-title" title="第3章第3篇：挖矿病毒">第3章第3篇：挖矿病毒</span>
            <span class="post-date" title="2019-10-16 13:40:00">2019/10/16</span>
        </a>
        
        <a  class="web实战 "
           href="/2019/10/16/第8篇：管理员账号被篡改/"
           data-tag="第五章"
           data-author="" >
            <span class="post-title" title="第5章第8篇：管理员账号被篡改">第5章第8篇：管理员账号被篡改</span>
            <span class="post-date" title="2019-10-16 13:39:00">2019/10/16</span>
        </a>
        
        <a  class="linux "
           href="/2019/10/16/第5篇：DDOS病毒/"
           data-tag="第三章"
           data-author="" >
            <span class="post-title" title="第3章第5篇：DDOS病毒">第3章第5篇：DDOS病毒</span>
            <span class="post-date" title="2019-10-16 13:39:00">2019/10/16</span>
        </a>
        
        <a  class="windows "
           href="/2019/10/16/第2篇：蠕虫病毒/"
           data-tag="第四章"
           data-author="" >
            <span class="post-title" title="第4章第2篇：蠕虫病毒">第4章第2篇：蠕虫病毒</span>
            <span class="post-date" title="2019-10-16 13:39:00">2019/10/16</span>
        </a>
        
        <a  class="windows "
           href="/2019/10/16/第1篇：FTP暴力破解/"
           data-tag="第四章"
           data-author="" >
            <span class="post-title" title="第4章第1篇：FTP暴力破解">第4章第1篇：FTP暴力破解</span>
            <span class="post-date" title="2019-10-16 13:39:00">2019/10/16</span>
        </a>
        
        <a  class="windows "
           href="/2019/10/16/第5篇：挖矿病毒（一）/"
           data-tag="第四章"
           data-author="" >
            <span class="post-title" title="第4章第5篇：挖矿病毒（一）">第4章第5篇：挖矿病毒（一）</span>
            <span class="post-date" title="2019-10-16 13:38:00">2019/10/16</span>
        </a>
        
        <a  class="windows "
           href="/2019/10/16/第3篇：勒索病毒/"
           data-tag="第四章"
           data-author="" >
            <span class="post-title" title="第4章第3篇：勒索病毒">第4章第3篇：勒索病毒</span>
            <span class="post-date" title="2019-10-16 13:38:00">2019/10/16</span>
        </a>
        
        <a  class="windows "
           href="/2019/10/16/第6篇：挖矿病毒（二）/"
           data-tag="第四章"
           data-author="" >
            <span class="post-title" title="第4章第6篇：挖矿病毒（二)">第4章第6篇：挖矿病毒（二)</span>
            <span class="post-date" title="2019-10-16 13:38:00">2019/10/16</span>
        </a>
        
        <a  class="windows "
           href="/2019/10/16/第4篇：ARP病毒/"
           data-tag="第四章"
           data-author="" >
            <span class="post-title" title="第4章第4篇：ARP病毒">第4章第4篇：ARP病毒</span>
            <span class="post-date" title="2019-10-16 13:38:00">2019/10/16</span>
        </a>
        
        <a  class="应急响应 "
           href="/2019/10/16/第1篇：Window入侵排查/"
           data-tag="第一章"
           data-author="" >
            <span class="post-title" title="第1章第1篇：window入侵排查">第1章第1篇：window入侵排查</span>
            <span class="post-date" title="2019-10-16 13:37:00">2019/10/16</span>
        </a>
        
        <a  class=""
           href="/2019/10/16/ 应急响应实战笔记/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="应急响应">应急响应</span>
            <span class="post-date" title="2019-10-16 12:30:54">2019/10/16</span>
        </a>
        
        <a  class="内网 "
           href="/2019/10/14/密码抓取/"
           data-tag="密码抓取"
           data-author="" >
            <span class="post-title" title="密码抓取">密码抓取</span>
            <span class="post-date" title="2019-10-14 20:46:00">2019/10/14</span>
        </a>
        
        <a  class="web "
           href="/2019/10/07/discuz-x3-4-getshell/"
           data-tag="web"
           data-author="" >
            <span class="post-title" title="discuz x3.4 getshell">discuz x3.4 getshell</span>
            <span class="post-date" title="2019-10-07 22:59:00">2019/10/07</span>
        </a>
        
        <a  class="web "
           href="/2019/10/07/google-hack-语法/"
           data-tag="web"
           data-author="" >
            <span class="post-title" title="google hack 语法">google hack 语法</span>
            <span class="post-date" title="2019-10-07 20:07:04">2019/10/07</span>
        </a>
        
        <a  class="内网 "
           href="/2019/10/07/windows中常见后门持久化方法总结/"
           data-tag="后门"
           data-author="" >
            <span class="post-title" title="windows后门持久化">windows后门持久化</span>
            <span class="post-date" title="2019-10-07 13:04:29">2019/10/07</span>
        </a>
        
        <a  class="msf "
           href="/2019/10/07/Meterpreter扩展速查表/"
           data-tag="msf"
           data-author="" >
            <span class="post-title" title="Meterpreter扩展速查表">Meterpreter扩展速查表</span>
            <span class="post-date" title="2019-10-07 08:22:28">2019/10/07</span>
        </a>
        
        <a  class="msf "
           href="/2019/10/07/Metasploit命令速查表/"
           data-tag="msf"
           data-author="" >
            <span class="post-title" title="Metasploit命令速查表">Metasploit命令速查表</span>
            <span class="post-date" title="2019-10-07 08:15:43">2019/10/07</span>
        </a>
        
        <a  class="msf "
           href="/2019/10/06/Meterpreter命令速查表/"
           data-tag="msf"
           data-author="" >
            <span class="post-title" title="Meterpreter命令速查表">Meterpreter命令速查表</span>
            <span class="post-date" title="2019-10-06 23:23:23">2019/10/06</span>
        </a>
        
        <a  class="web "
           href="/2019/10/06/sqlmap/"
           data-tag="sqlmap"
           data-author="" >
            <span class="post-title" title="sqlmap">sqlmap</span>
            <span class="post-date" title="2019-10-06 23:15:44">2019/10/06</span>
        </a>
        
        <a  class=""
           href="/2019/10/06/信息收集/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="信息收集">信息收集</span>
            <span class="post-date" title="2019-10-06 23:11:29">2019/10/06</span>
        </a>
        
        <a  class="web "
           href="/2019/10/06/phpmyadmin后台getshell/"
           data-tag="phpmyadmin"
           data-author="" >
            <span class="post-title" title="phpmyadmin后台getshell">phpmyadmin后台getshell</span>
            <span class="post-date" title="2019-10-06 22:53:19">2019/10/06</span>
        </a>
        
        <a  class=""
           href="/2019/10/06/py一句话开启http服务/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="py一句话开启http服务">py一句话开启http服务</span>
            <span class="post-date" title="2019-10-06 18:52:55">2019/10/06</span>
        </a>
        
    </nav>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-windows中常见后门持久化方法总结" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">windows后门持久化</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            
                <a href="javascript:" data-rel="内网">内网</a>
            
        </span>
        
        
        <span class="tag">
            
            <a href="javascript:" class="color3">后门</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
        创建时间:<time class="date" title='更新时间: 2019-10-07 15:38:52'>2019-10-07 13:04</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:4.8k</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读:<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
        <span class="top-comment" title="跳转至评论区">
            <a href="#comments">
                评论:<span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </a>
        </span>
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#windows后门持久化"><span class="toc-text">windows后门持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#shift后门"><span class="toc-text">shift后门</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#映像劫持"><span class="toc-text">映像劫持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#注册表自启动项"><span class="toc-text">注册表自启动项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#定时任务"><span class="toc-text">定时任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#用户登陆初始化"><span class="toc-text">用户登陆初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Logon-Scripts"><span class="toc-text">Logon Scripts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#屏幕保护程序"><span class="toc-text">屏幕保护程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自启动服务"><span class="toc-text">自启动服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#影子用户"><span class="toc-text">影子用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CLR"><span class="toc-text">CLR</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hijack-CAccPropServicesClass-and-MMDeviceEnumerator"><span class="toc-text">Hijack CAccPropServicesClass and MMDeviceEnumerator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#劫持MruPidlList"><span class="toc-text">劫持MruPidlList</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#office系列"><span class="toc-text">office系列</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Word-WLL"><span class="toc-text">Word WLL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Excel-XLL"><span class="toc-text">Excel XLL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PowerPoint-VBA-add-ins"><span class="toc-text">PowerPoint VBA add-ins</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文件关联"><span class="toc-text">文件关联</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#相关注册表"><span class="toc-text">相关注册表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AppInit-DLLs"><span class="toc-text">AppInit_DLLs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Netsh-helper"><span class="toc-text">Netsh helper</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#利用BITS"><span class="toc-text">利用BITS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#利用inf文件实现后门"><span class="toc-text">利用inf文件实现后门</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#后记"><span class="toc-text">后记</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="windows后门持久化"><a href="#windows后门持久化" class="headerlink" title="windows后门持久化"></a>windows后门持久化</h2><p>原文链接：<br><a href="https://xz.aliyun.com/t/6461#toc-11" target="_blank" rel="noopener">https://xz.aliyun.com/t/6461#toc-11</a></p>
<p>shift后门<br>映像劫持<br>注册表自启动项<br>定时任务<br>用户登陆初始化<br>Logon Scripts<br>屏幕保护程序<br>自启动服务<br>影子用户<br>waitfor<br>CLR<br>Hijack CAccPropServicesClass and MMDeviceEnumerator<br>劫持MruPidlList<br>office系列<br>Word WLL<br>Excel XLL<br>PowerPoint VBA add-ins<br>文件关联<br>AppInit_DLLs<br>Netsh helper<br>利用BITS<br>利用inf文件实现后门<br>后记  </p>
<h3 id="shift后门"><a href="#shift后门" class="headerlink" title="shift后门"></a>shift后门</h3><p>这个是比较老的方式了，这里简单讲一下，在windows中有一些辅助功能，能在用户未登录系统之前可以通过组合键来启动它，类似的辅助功能有：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\sethc.exe 粘滞键，启动快捷键：按五次shift键</span><br><span class="line">C:\Windows\System32\utilman.exe 设置中心，启动快捷键：Windows+U键</span><br></pre></td></tr></table></figure>

<p>在低版本的windows中，我们可以直接把setch.exe替换成我们的后门程序，下面我们把setch.exe替换为cmd.exe</p>
<h3 id="映像劫持"><a href="#映像劫持" class="headerlink" title="映像劫持"></a>映像劫持</h3><p>这个和shift后门差不多，只不过在低版本的windows中，我们可以简单地替换程序，但是在高版本的windows版本中替换的文件受到了系统的保护，所以这里我们要使用另外一个知识点：映像劫持。</p>
<p>“映像劫持”，也被称为”IFEO”（Image File Execution Options）</p>
<p>就是Image File Execution Options（其实应该称为”image Hijack”。）是为一些在默认系统环境中运行时可能引发错误的程序执行体提供特殊的环境设定。由于这个项主要是用来调试程序用的，对一般用户意义不大。默认是只有管理员和local system有权读写修改。<br>PS：来自百度百科<br>简单来说就是当目标程序被映像劫持时，当我们启动目标程序时，启动的是劫持后的程序而不是原来的程序</p>
<p>操作也很简单，在注册表的HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Option下添加一个项sethc.exe，然后在sethc.exe这个项中添加debugger键，键值为我们恶意程序的路径，如下图</p>
<h3 id="注册表自启动项"><a href="#注册表自启动项" class="headerlink" title="注册表自启动项"></a>注册表自启动项</h3><p>MSF的Persistence模块利用的就是写注册表自启动项来实现的，一般自启动项是这两个键：Run和RunOnce，两者的区别如下</p>
<p>Run：该项下的键值即为开机启动项，每一次随着开机而启动。</p>
<p>RunOnce：RunOnce和Run差不多，唯一的区别就是RunOnce的键值只作用一次，执行完毕后就会自动删除</p>
<p>常见注册表启动项键的位置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">用户级</span><br><span class="line"></span><br><span class="line">\HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run</span><br><span class="line">\HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce</span><br><span class="line">系统级</span><br><span class="line"></span><br><span class="line">\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</span><br><span class="line">\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce</span><br><span class="line">\HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Run</span><br><span class="line">\HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\RunOnce</span><br></pre></td></tr></table></figure>

<h3 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h3><p>windows下定时任务的命令有两个分别是：at和schtasks，他们两者主要区别是at命令在win7、08等高版本的windows中是不能将任务在前台执行的，也就是只会打开一个后台进程，而schtasks是将定时的任务在前台执行，下面我们逐个看看</p>
<p>at的一些参数</p>
<p>AT [\computername] time [/INTERACTIVE]<br>    [ /EVERY:date[,…] | /NEXT:date[,…]] “command”</p>
<p>schtasks一些参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schtasks /create /tn TaskName /tr TaskRun /sc schedule [/mo modifier] [/d day] [/m month[,month...] [/i IdleTime] [/st StartTime] [/sd StartDate] [/ed EndDate] [/s computer [/u [domain\]user /p password]] [/ru &#123;[Domain\]User | &quot;System&quot;&#125; [/rp Password]] /?</span><br></pre></td></tr></table></figure>

<p>schtasks的执行如下：</p>
<h3 id="用户登陆初始化"><a href="#用户登陆初始化" class="headerlink" title="用户登陆初始化"></a>用户登陆初始化</h3><p>Userinit的作用是用户在进行登陆初始化设置时，WinLogon进程会执行指定的login scripts，所以我们可以修改它的键值来添加我们要执行的程序</p>
<p>注册表路径为：HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Userinit，我们添加一个我们启动的程序，多个程序用逗号隔开</p>
<h3 id="Logon-Scripts"><a href="#Logon-Scripts" class="headerlink" title="Logon Scripts"></a>Logon Scripts</h3><p>Logon Scripts优先于av先执行，我们可以利用这一点来绕过av的敏感操作拦截</p>
<p>注册表路径为：HKEY_CURRENT_USER\Environment，创建一个键为：UserInitMprLogonScript，其键值为我们要启动的程序路径</p>
<h3 id="屏幕保护程序"><a href="#屏幕保护程序" class="headerlink" title="屏幕保护程序"></a>屏幕保护程序</h3><p>在对方开启屏幕保护的情况下，我们可以修改屏保程序为我们的恶意程序从而达到后门持久化的目的<br>其中屏幕保护的配置存储在注册表中，其位置为：HKEY_CURRENT_USER\Control Panel\Desktop，关键键值如下：</p>
<p>SCRNSAVE.EXE - 默认屏幕保护程序，我们可以把这个键值改为我们的恶意程序</p>
<p>ScreenSaveActive - 1表示屏幕保护是启动状态，0表示表示屏幕保护是关闭状态</p>
<p>ScreenSaverTimeout - 指定屏幕保护程序启动前系统的空闲事件，单位为秒，默认为900（15分钟）</p>
<h3 id="自启动服务"><a href="#自启动服务" class="headerlink" title="自启动服务"></a>自启动服务</h3><p>自启动服务一般是在电脑启动后在后台加载指定的服务程序，我们可以将exe文件注册为服务，也可以将dll文件注册为服务</p>
<p>为了方便起见我们可以直接用Metasploit来注册一个服务</p>
<p>meterpreter &gt; run metsvc -A</p>
<p>运行之后msf会在%TMP%目录下创建一个随机名称的文件夹，然后在该文件夹里面生成三个文件：metsvc.dll、metsvc-server.exe、metsvc.exe</p>
<p>同时会新建一个服务，其显示名称为Meterpreter，服务名称为metsvc，启动类型为”自动”，默认绑定在31337端口。</p>
<p>如果想删除服务，可以执行</p>
<p>meterpreter &gt; run metsvc -r</p>
<h3 id="影子用户"><a href="#影子用户" class="headerlink" title="影子用户"></a>影子用户</h3><p>影子用户顾名思义就是一个隐藏用户，只能通过注册表查看这个用户，其它方式是找不到这个用户的信息的</p>
<p>在用户名后面加一个$可以创建一个匿名用户，创建完毕后我们再把这个用户添加到administrator组</p>
<p>net user test$ test /add<br>net localgroup administrators test$ /add<br>可以看到net user是看不到我们创建的用户，但是计算机管理-用户和组中可以看到</p>
<p>所以这时候我们就需要修改一下注册表，其键位置为：HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users</p>
<p>注意：SAM键值默认是只能system权限修改的，所以我们要修改一下SAM键的权限，给予administrator完全控制和读取的权限</p>
<p>然后我们将administrator用户对应的项中的F值复制到test$对应xiang中的F值，然后保存</p>
<p>然后我们将test$删除掉</p>
<p>net user test$ /del<br>然后再双击导出的注册表文件，然后我们再看一下</p>
<p>net user和计算机管理-用户和组中都查看不到用户了，但是我们可以用net user test$查看用户信息</p>
<p>这个时候我们再用net user test$ /del是删除不掉这个用户的，只能通过注册表来删除。</p>
<p>waitfor<br>关于waitfor手册中是这么解释的：</p>
<p>在系统上发送或等待信号。waitfor可用于跨网络同步计算机。<br>waitfor的语法</p>
<p>waitfor [/s <computer> [/u [<domain>]<user> [/p [<password>]]]] /si <signalname><br>waitfor [/t <timeout>] <signalname><br>参数解释：</signalname></timeout></signalname></password></user></domain></computer></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/s &lt;Computer&gt;  指定远程计算机的名称或IP地址，默认为本地计算机</span><br><span class="line">/u [&lt;Domain&gt;]&lt;user&gt;    使用指定用户帐户的凭据运行脚本。默认是使用当前用户的凭据。</span><br><span class="line">/p &lt;Password&gt;  指定/u参数中指定的用户帐户的密码。</span><br><span class="line">/si            发送指定激活信号。</span><br><span class="line">/t             指定等待信号的秒数。默认为无限期等待。 </span><br><span class="line">&lt;SignalName&gt;    指定等待或发送的信号，不区分大小写，长度不能超过225个字符</span><br></pre></td></tr></table></figure>

<p>我们来测试一下看看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">waitfor test &amp;&amp; calc 表示接收信号成功后执行计算器   </span><br><span class="line">waitfor /s 192.168.163.143 /u qiyou /p qiyou /si test</span><br></pre></td></tr></table></figure>

<p>但是这样只能执行一次，这对我们后门持久化很不利，所以我们得想办法让它持久化。</p>
<p>这里就要借用一下三好师傅的powershell脚本：<a href="https://github.com/3gstudent/Waitfor-Persistence/blob/master/Waitfor-Persistence.ps1" target="_blank" rel="noopener">https://github.com/3gstudent/Waitfor-Persistence/blob/master/Waitfor-Persistence.ps1</a></p>
<p>该方法的优点就是能主动激活，但是缺点也明显就是只能在同一网段才能接收和发送激活信号、服务器重启之后就不行了。</p>
<h3 id="CLR"><a href="#CLR" class="headerlink" title="CLR"></a>CLR</h3><p>CLR的简述（来自百度百科）</p>
<p>CLR(公共语言运行库,Common Language Runtime)和Java虚拟机一样也是一个运行时环境，是一个可由多种编程语言使用的运行环境。CLR的核心功能包括：内存管理、程序集加载、安全性、异常处理和线程同步，可由面向CLR的所有语言使用。并保证应用和底层操作系统之间必要的分离。CLR是.NET Framework的主要执行引擎。<br>需要注意的是CLR能够劫持系统中全部.net程序，而且系统默认会调用.net程序，从而导致我们的后门自动触发，这是我们后门持久化的一个好的思路，下面来实现一下</p>
<p>修改一下注册表，注册表路径：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKEY_CURRENT_USER\Software\Classes\CLSID\，新建子项&#123;11111111-1111-1111-1111-111111111111&#125;（名字随便，只要不与注册表中存在的名称冲突就行），然后再新建子项InProcServer32，新建一个键ThreadingModel，键值为：Apartment，默认的键值为我们dll的路径</span><br></pre></td></tr></table></figure>

<p>然后在cmd下设置一下：<br>PS：要注册为全局变量，不然只能在当前cmd窗口劫持.net程序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SETX COR_ENABLE_PROFILING=1 /M</span><br><span class="line">SETX COR_PROFILER=&#123;11111111-1111-1111-1111-111111111111&#125; /M</span><br></pre></td></tr></table></figure>

<p>然后执行一波，效果如下，可以看到已经成功劫持了</p>
<h3 id="Hijack-CAccPropServicesClass-and-MMDeviceEnumerator"><a href="#Hijack-CAccPropServicesClass-and-MMDeviceEnumerator" class="headerlink" title="Hijack CAccPropServicesClass and MMDeviceEnumerator"></a>Hijack CAccPropServicesClass and MMDeviceEnumerator</h3><p>什么是COM（来自WIKI）</p>
<p>组件对象模型（英语：Component Object Model，缩写COM）是微软的一套软件组件的二进制接口标准。这使得跨编程语言的进程间通信、动态对象创建成为可能。COM是多项微软技术与框架的基础，包括OLE、OLE自动化、ActiveX、COM+、DCOM、Windows shell、DirectX、Windows Runtime。<br>这个和CRL劫持.NET程序类似，也是通过修改CLSID下的注册表键值，实现对CAccPropServicesClass和MMDeviceEnumerator的劫持，而系统很多正常程序启动时需要调用这两个实例，所以这个很适合我们的后门持久化。</p>
<p>经测试貌似64位系统下不行（或许是我姿势的问题），但是32位系统下可以，下面说一下32位系统利用方法：</p>
<p>在%APPDATA%\Microsoft\Installer{BCDE0395-E52F-467C-8E3D-C4579291692E}\下放入我们的后门dll，重命名为test._dl</p>
<p>PS：如果Installer文件夹不存在，则依次创建Installer{BCDE0395-E52F-467C-8E3D-C4579291692E}</p>
<p>然后就是修改注册表了，在注册表位置为：HKCU\Software\Classes\CLSID\下创建项{b5f8350b-0548-48b1-a6ee-88bd00b4a5e7}，然后再创建一个子项InprocServer32，默认为我们的dll文件路径：C:\Users\qiyou\AppData\Roaming\Microsoft\Installer{BCDE0395-E52F-467C-8E3D-C4579291692E}，再创建一个键ThreadingModel，其键值为：Apartment</p>
<p>然后就是测试了，打开iexplore.exe，成功弹框</p>
<p>PS：{b5f8350b-0548-48b1-a6ee-88bd00b4a5e7}对应CAccPropServicesClass，{BCDE0395-E52F-467C-8E3D-C4579291692E}对应MMDeviceEnumerator</p>
<h3 id="劫持MruPidlList"><a href="#劫持MruPidlList" class="headerlink" title="劫持MruPidlList"></a>劫持MruPidlList</h3><p>在注册表位置为HKCU\Software\Classes\CLSID\下创建项{42aedc87-2188-41fd-b9a3-0c966feabec1}，再创建一个子项InprocServer32，默认的键值为我们的dll路径，再创建一个键ThreadingModel，其键值：Apartment</p>
<p>该注册表对应COM对象MruPidlList，作用于shell32.dll，而shell32.dll是Windows的32位外壳动态链接库文件，用于打开网页和文件，建立文件时的默认文件名的设置等大量功能。其中explorer.exe会调用shell32.dll，然后会加载COM对象MruPidlList，从而触发我们的dll文件</p>
<p>当用户重启时或者重新创建一个explorer.exe进程时，就会加载我们的恶意dll文件，从而达到后门持久化的效果。这里我们直接结束一个explorer.exe进程再起一个进程来看一下效果</p>
<h3 id="office系列"><a href="#office系列" class="headerlink" title="office系列"></a>office系列</h3><h4 id="Word-WLL"><a href="#Word-WLL" class="headerlink" title="Word WLL"></a>Word WLL</h4><p>把dll文件保存在%APPDATA%\Microsoft\Word\Startup，然后把后缀名改为wll<br>PS：Startup支持启动多个wll<br>打开word，成功弹框</p>
<h4 id="Excel-XLL"><a href="#Excel-XLL" class="headerlink" title="Excel XLL"></a>Excel XLL</h4><p>Excel dll的编写可以参考三好师傅这个项目：链接<br><a href="https://github.com/3gstudent/Add-Dll-Exports" target="_blank" rel="noopener">https://github.com/3gstudent/Add-Dll-Exports</a><br>用三好师傅powershell脚本生成现成的Excel dll：<br><a href="https://github.com/3gstudent/Office-Persistence" target="_blank" rel="noopener">https://github.com/3gstudent/Office-Persistence</a><br>将生成的DLL文件复制到%appdata%\Microsoft\AddIns目录下，然后再修改一下注册表，office版本对应的注册表位置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">office2003 — HKEY_CURRENT_USER\Software\Microsoft\Office\11.0\</span><br><span class="line">office2007 — HKEY_CURRENT_USER\Software\Microsoft\Office\12.0\</span><br><span class="line">office2010 — HKEY_CURRENT_USER\Software\Microsoft\Office\14.0\</span><br><span class="line">office2013 — HKEY_CURRENT_USER\Software\Microsoft\Office\15.0\</span><br><span class="line">office2016 — HKEY_CURRENT_USER\Software\Microsoft\Office\16.0\</span><br></pre></td></tr></table></figure>

<p>我这里使用的2010的，所以我们要修改的是HKEY_CURRENT_USER\Software\Microsoft\Office\14.0\Excel\Options，添加一个键OPEN，键值为：/R test.dll</p>
<p>然后打开Excel，发现成功弹出计算器</p>
<h4 id="PowerPoint-VBA-add-ins"><a href="#PowerPoint-VBA-add-ins" class="headerlink" title="PowerPoint VBA add-ins"></a>PowerPoint VBA add-ins</h4><p>用三好师傅powershell脚本生成现成的PowerPoint dll：链接<br><a href="https://github.com/3gstudent/Office-Persistence" target="_blank" rel="noopener">https://github.com/3gstudent/Office-Persistence</a>  </p>
<p>将生成的DLL文件复制到%appdata%\Microsoft\AddIns目录下，然后参考前面我给出的office版本对应的注册表位置，在HKEY_CURRENT_USER\Software\Microsoft\Office\14.0\PowerPoint下新建一个子项：AddIns，然后在AddIns下面新建一个子项test，新建一个键为Autoload，类型为DWORD，键值为：1；新建一个键为Path，类型为SZ，键值为我们dll文件的路径</p>
<p>打开PowerPoint成功弹出计算器</p>
<h3 id="文件关联"><a href="#文件关联" class="headerlink" title="文件关联"></a>文件关联</h3><p>什么是文件关联</p>
<p>文件关联就是将一种类型的文件与一个可以打开它的程序建立起一种依存关系。一个文件可以与多个应用程序发生关联。可以利用文件的“打开方式”进行关联选择。<br>举个例子来说，位图文件（BMP文件）在Windows中的默认关联程序是“图片”，如果将其默认关联改为用ACDSee程序来打开，那么ACDSee就成了它的默认关联程序。<br>PS：来自百度百科<br>我们可以用assoc命令显示或修改文件扩展名关联，我们可以看一下.txt文件的关联</p>
<p>我们可以用ftype命令显示或修改用在文件扩展名关联中的文件类型</p>
<h3 id="相关注册表"><a href="#相关注册表" class="headerlink" title="相关注册表"></a>相关注册表</h3><p>HKEY_CURRENT_USER\Software\Classe    //保存了当前用户的类注册和文件扩展名信息<br>HKEY_LOCAL_MACHINE\Software\Classe   //保存了系统所有用户用户的类注册和文件扩展名信息<br>HKEY_CLASS_ROOT                      //HKEY_CLASSES_ROOT项提供合并来自上面两个的信息的注册表的视图<br>我们以.txt为例，通过文件关联来修改它默认打开的程序。<br>修改\HKEY_CLASS_ROOT\txtfile\shell\open\command的默认值为我们要执行的程序  </p>
<h3 id="AppInit-DLLs"><a href="#AppInit-DLLs" class="headerlink" title="AppInit_DLLs"></a>AppInit_DLLs</h3><p>User32.dll被加载到进程时，会读取AppInit_DLLs注册表项，如果有值，调用LoadLibrary() api加载用户dll。</p>
<p>其注册表位置为：HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows\AppInit_DLLs，把AppInit_DLLs的键值设置为我们dll路径，将LoadAppInit_DLLs设置为1</p>
<h3 id="Netsh-helper"><a href="#Netsh-helper" class="headerlink" title="Netsh helper"></a>Netsh helper</h3><p>netsh（全称：Network Shell） 是windows系统本身提供的功能强大的网络配置命令行工具，它可以添加自定的dll从而拓展其功能，我们可以使用netsh add helper yourdll.dll来添加拓展功能，添加了之后，在启动netsh的时候就会加载我们dll文件</p>
<p>添加自定义helper dll<br>我们可以使用两种方式来添加helper：<br>通过cmd添加helper</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh add helper test.dll</span><br></pre></td></tr></table></figure>

<p>通过注册表添加helper<br>其位置为：HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\NetSh，创建一个键，名称随便，键值为我们dll的路径</p>
<h3 id="利用BITS"><a href="#利用BITS" class="headerlink" title="利用BITS"></a>利用BITS</h3><p>BITS (后台智能传送服务) 是一个 Windows 组件，它可以在前台或后台异步传输文件，为保证其他网络应用程序获得响应而调整传输速度，并在重新启动计算机或重新建立网络连接之后自动恢复文件传输。</p>
<p>bitsadmin是一个命令行工具，用于创建下载或上传任务并监视其进度。你可以执行bitsadmin /?或bitsadmin /HELP获取帮助列表。</p>
<p>常见的bitsadmin命令</p>
<p>bitsadmin /create [type] DisplayName //创建一个任务<br>bitsadmin /cancel <job> //删除一个任务<br>bitsadmin /list /allusers /verbose //列出所有任务<br>bitsadmin /AddFile <job> <remoteurl> <localname> //给任务test添加一个下载文件<br>bitsadmin /SetNotifyCmdLine <job> <programname>   [ProgramParameters] //设置在任务完成传输时或任务进入状态时将运行的命令行命令。<br>bitsadmin /Resume <job> //激活传输队列中的新任务或挂起的任务。<br>bitsadmin /cancel <job> //删除某个任务<br>bitsadmin /reset /allusers //删除所有任务<br>bitsadmin /complete <job> //完成某个任务<br>下面我们来测试一下：</job></job></job></programname></job></localname></remoteurl></job></job></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bitsadmin /create test</span><br><span class="line">bitsadmin /addfile test c:\windows\system32\calc.exe c:\Users\qiyou\Desktop\calc.exe //为了方便起见我们直接复制本地文件</span><br><span class="line">bitsadmin /SetNotifyCmdLine test cmd.exe &quot;cmd.exe /c calc.exe&quot;</span><br><span class="line">bitsadmin /resume test</span><br></pre></td></tr></table></figure>

<p>重启电脑之后任务还是存在</p>
<p>如果我们想让任务完成，可以执行bitsadmin /complete test，calc.exe也会复制到桌面上</p>
<h3 id="利用inf文件实现后门"><a href="#利用inf文件实现后门" class="headerlink" title="利用inf文件实现后门"></a>利用inf文件实现后门</h3><p>inf文件</p>
<p>INF文件或安装信息文件是Microsoft Windows用于安装软件和驱动程序的纯文本文件。INF文件最常用于安装硬件组件的设备驱动程序。Windows包含用于创建基于INF的安装的IExpress工具。INF文件是Windows安装程序API及其后续版本Windows Installer的一部分。<br>PS：来自WIKI<br>inf文件的结构<br>想了解更多可以看一下微软的手册：<a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-2000-server/cc939869(v=technet.10)#information-inf-file-entries" target="_blank" rel="noopener">https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-2000-server/cc939869(v=technet.10)#information-inf-file-entries</a></p>
<ol>
<li><p>DefaultInstall节（来自WIKI）<br>INF文件的结构与INI文件的结构非常类似; 它包含用于指定要复制的文件，对注册表的更改等的各个部分。所有INF文件都包含一个[Version]带有Signature 键值对的部分，用于指定INF文件所针对的Windows版本。签名通常是$CHICAGO$（对于Windows 9x）或$WINDOWS NT$（对于Windows NT / 2K / XP）。其余大多数部分是用户定义的，并且包含特定于要安装的组件的信息。</p>
</li>
<li><p>DefaultInstall节（来自微软的手册）<br> RunPreSetupCommands-本节中指定的命令在安装服务配置文件之前运行。<br> RunPostSetupCommands-本节中指定的命令在安装程序完成服务配置文件后运行。<br> RunPreUnInstCommands-本节中指定的命令在卸载程序开始之前运行。<br> RunPostUnInstCommands-本节中指定的命令在卸载程序运行后运行。<br>下面举一个calc.inf弹计算器的例子<br><code>[Version]
Signature=&quot;$CHICAGO$&quot;
AdvancedINF=2.5,&quot;test&quot;
[DefaultInstall]
RunPreSetupCommands=Command1
[Command1]
C:\windows\system32\calc.exe</code><br>命令行下执行：</p>
</li>
</ol>
<p><code>rundll32.exe advpack.dll,LaunchINFSection calc.inf,DefaultInstall</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">后门实现：</span><br><span class="line">在注册表HKEY_CURRENT_USER\Software\Microsoft\处依次新建子项\IEAK\GroupPolicy\PendingGPOs，然后再新建几个键，如下：</span><br><span class="line">键：Count，类型：REG_DWORD，键值：1</span><br><span class="line">键：Path1，类型：REG_SZ，键值：C:\Users\Administrator\Desktop\test\calc.inf //这个为我们inf文件的路径，这里以上面那个inf文件例子为例</span><br><span class="line">键：Section1，类型：REG_SZ，键值：DefaultInstall</span><br></pre></td></tr></table></figure>

<p>重启电脑之后成功弹出计算器<br>但是重启之后PendingGPOs该项就会被清除，需要我们重新修改注册表</p>
<h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><p>以上就是我所总结后门持久化的所有内容了，当然还有很多方法没有在文章内提及，虽然有的方法都是老生常谈的了，但是还是在一些实战环境中屡试不爽，有一句话说的好（这句话忘记是哪位师傅说的了=。=）：知识面宽度决定攻击面广度，知识链深度决定攻击链的长度</p>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以在下面评论区评论，也可以邮件至 cxaqhq@qq.com </span>
    </div>
</article>


<p>
    <a href="javascript:void(0)" class="dashang" onclick="dashangToggle()">赏</a>
</p>


<div class="article_copyright">
    <p><span class="copy-title">文章标题:</span>windows后门持久化</p>
    <p><span class="copy-title">文章字数:</span><span class="post-count">4.8k</span></p>
    <p><span class="copy-title">本文作者:</span><a href="javascript:void(0)" title="cx">cx</a></p>
    <p><span class="copy-title">发布时间:</span>2019-10-07, 13:04:29</p>
    <p><span class="copy-title">最后更新:</span>2019-10-07, 15:38:52</p>
  
</div>



    <div id="comments"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

<script type="text/javascript">
    $.getScript('/js/gitalk.js', function () {
        var gitalk = new Gitalk({
            clientID: 'e73781144304d69620be',
            clientSecret: 'fc7949d93e6de6f18c4acabe3f7ac4a48047bdd3',
            repo: 'cx',
            owner: 'cxaqhq',
            admin: ['cxaqhq'],
            id: decodeURI(location.pathname),
            distractionFreeMode: 'true',
            language: 'zh-CN',
            perPage: parseInt('10',10)
        })
        gitalk.render('comments')
    })
</script>




    




    </div>
    <div class="copyright">
        <p class="footer-entry">©2019</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">目录</span>
    <div class="post-toc-content">

    </div>
</div>
<a class="" id="rocket" href="javascript:void(0)"></a>
    </div>
</div>
<div class="acParent"></div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close" href="javascript:void(0)" onclick="dashangToggle()">×</a>
    <div class="shang_tit">
        <p>喜欢就点赞,疼爱就打赏</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/zfb.jpg" class="alipay" title="扫码支持">
            <img src="/img/wx.jpg" class="weixin" title="扫码支持">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">支付宝</label></span><span><label><input type="radio" name="pay" value="weixin">微信</label></span>
    </div>
</div>


</body>
<script src="/js/jquery.pjax.js?v=1.0.1" ></script>

<script src="/js/script.js?v=1.0.1" ></script>
<script>
    var img_resize = 'default';
    /*作者、标签的自动补全*/
    $(function () {
        $('.search').AutoComplete({
            'data': ['#msf','#web','#phpmyadmin','#sqlmap','#密码抓取','#第四章','#第三章','#第五章','#第二章','#第一章','#后门','#法律',],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $(".post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*高亮代码块行号*/
        
        $('pre code').each(function(){
            var lines = $(this).text().split('\n').length - 1, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
    }

    /*打赏页面隐藏与展示*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--加入行号的高亮代码块样式-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0px;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 0.5em 3px 0.7em 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: #fafafa;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
        .nav .hide-list.fullscreen {
            left: 492px
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    
    .post .pjax article .article-entry>ol, .post .pjax article .article-entry>ul, .post .pjax article>ol, .post .pjax article>ul{
        border: #e2dede solid 1px;
        border-radius: 10px;
        padding: 10px 32px 10px 56px;
    }
    .post .pjax article .article-entry li>ol, .post .pjax article .article-entry li>ul,.post .pjax article li>ol, .post .pjax article li>ul{
        padding-top: 5px;
        padding-bottom: 5px;
    }
    .post .pjax article .article-entry>ol>li, .post .pjax article .article-entry>ul>li,.post .pjax article>ol>li, .post .pjax article>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    .post .pjax article .article-entry li>ol>li, .post .pjax article .article-entry li>ul>li,.post .pjax article li>ol>li, .post .pjax article li>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        background: url("https://i.loli.net/2019/07/22/5d3521411f3f169375.png");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>







</html>
